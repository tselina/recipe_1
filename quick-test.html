<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Test</title>
</head>
<body>
    <h1>Quick Integration Test</h1>
    <div id="results"></div>

    <!-- Load modules in correct order -->
    <script src="js/storage-manager.js"></script>
    <script src="js/data-models.js"></script>
    <script src="js/barcode-scanner.js"></script>
    <script src="js/product-database.js"></script>
    <script src="js/recipe-manager.js"></script>
    <script src="js/portion-calculator.js"></script>
    <script src="js/ui-controller.js"></script>
    <script src="js/app.js"></script>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.style.padding = '5px';
            div.style.margin = '2px';
            div.style.borderRadius = '3px';
            
            if (type === 'success') {
                div.style.backgroundColor = '#d4edda';
                div.style.color = '#155724';
            } else if (type === 'error') {
                div.style.backgroundColor = '#f8d7da';
                div.style.color = '#721c24';
            } else {
                div.style.backgroundColor = '#d1ecf1';
                div.style.color = '#0c5460';
            }
            
            div.textContent = message;
            results.appendChild(div);
            console.log(message);
        }

        // Wait for all scripts to load
        setTimeout(() => {
            try {
                log('üöÄ Starting Quick Integration Test');
                
                // Clear any existing data first
                const storage = new StorageManager();
                storage.clearAll();
                log('‚úÖ Storage cleared');
                
                // Test component creation
                const recipeManager = new RecipeManager(storage);
                const calculator = new PortionCalculator();
                const productDb = new ProductDatabase(storage);
                const barcodeScanner = new BarcodeScanner();
                log('‚úÖ All components created successfully');
                
                // Test UIController creation (should not fail on missing DOM elements)
                const uiController = new UIController(recipeManager, calculator, productDb, storage);
                log('‚úÖ UIController created successfully (with DOM safety checks)');
                
                // Test recipe creation
                const recipe = recipeManager.createRecipe('Quick Test Recipe', [
                    { name: 'Test Ingredient 1', weight: 100 },
                    { name: 'Test Ingredient 2', weight: 50 }
                ]);
                log('‚úÖ Recipe created: ' + recipe.name + ' (' + recipe.totalWeight + 'g)');
                
                // Test portion calculation
                const result = calculator.calculatePortions(recipe, 75);
                log('‚úÖ Portion calculated: ' + result.consumedWeight + 'g consumed');
                
                // Test recipe consumption tracking
                recipeManager.recordConsumption(recipe.id, 75);
                const updatedRecipe = recipeManager.getRecipeById(recipe.id);
                log('‚úÖ Consumption recorded: ' + updatedRecipe.remainingWeight + 'g remaining');
                
                // Test product database
                const product = productDb.addProduct('Test Product', 'TEST123');
                const searchResults = productDb.searchProducts('Test');
                log('‚úÖ Product database working: ' + searchResults.length + ' results found');
                
                // Test barcode scanner status
                const scannerStatus = barcodeScanner.getStatus();
                log('‚úÖ Barcode scanner status: supported=' + scannerStatus.isSupported);
                
                // Test message display (should fallback to console)
                uiController.showSuccessMessage('Test success message');
                uiController.showErrorMessage('Test error message');
                log('‚úÖ Message display working (console fallback)');
                
                // Cleanup
                storage.clearAll();
                log('üéâ All tests passed! Integration is working correctly.');
                
            } catch (error) {
                log('‚ùå Test failed: ' + error.message, 'error');
                console.error('Test error:', error);
            }
        }, 300);
    </script>
</body>
</html>