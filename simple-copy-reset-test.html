<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Copy & Reset Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>Simple Copy & Reset Test</h1>
    <div id="results"></div>

    <!-- Only include essential scripts -->
    <script src="js/data-models.js"></script>
    <script src="js/storage-manager.js"></script>
    <script src="js/recipe-manager.js"></script>
    <script src="js/barcode-generator.js"></script>

    <script>
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            document.getElementById('results').appendChild(div);
        }

        try {
            log('Starting Simple Copy & Reset Test...', 'info');

            // Test 1: Initialize components
            const storage = new StorageManager();
            const recipeManager = new RecipeManager(storage);
            log('âœ“ Components initialized successfully', 'success');

            // Test 2: Clear existing data
            recipeManager.clearAllRecipes();
            log('âœ“ Cleared existing recipes', 'success');

            // Test 3: Create test recipe
            const recipe = recipeManager.createRecipe('Test Recipe', [
                { name: 'Ingredient 1', weight: 100 },
                { name: 'Ingredient 2', weight: 200 }
            ]);
            log(`âœ“ Recipe created: ${recipe.name} (${recipe.totalWeight}g)`, 'success');

            // Test 4: Consume some of the recipe
            recipeManager.recordConsumption(recipe.id, 150);
            const partiallyConsumed = recipeManager.getRecipeById(recipe.id);
            log(`âœ“ Consumed 150g, remaining: ${partiallyConsumed.remainingWeight}g`, 'success');

            // Test 5: Copy recipe
            const copiedRecipe = recipeManager.copyRecipe(recipe.id, 'Test Recipe Copy');
            log(`âœ“ Recipe copied: ${copiedRecipe.name} (${copiedRecipe.remainingWeight}g remaining)`, 'success');

            // Test 6: Verify copy has full weight
            if (copiedRecipe.remainingWeight === copiedRecipe.totalWeight) {
                log('âœ“ Copy has full remaining weight (consumption reset)', 'success');
            } else {
                log('âœ— Copy remaining weight not reset correctly', 'error');
            }

            // Test 7: Fully consume original
            recipeManager.markAsFullyConsumed(recipe.id);
            const fullyConsumed = recipeManager.getRecipeById(recipe.id);
            log(`âœ“ Original recipe fully consumed: ${fullyConsumed.remainingWeight}g remaining`, 'success');

            // Test 8: Reset original recipe
            const resetRecipe = recipeManager.resetRecipe(recipe.id);
            log(`âœ“ Recipe reset: ${resetRecipe.remainingWeight}g remaining`, 'success');

            // Test 9: Verify reset worked
            if (resetRecipe.remainingWeight === resetRecipe.totalWeight && resetRecipe.lastConsumed === null) {
                log('âœ“ Reset functionality working correctly', 'success');
            } else {
                log('âœ— Reset functionality not working correctly', 'error');
            }

            // Test 10: Test barcode generator
            const barcodeGenerator = new BarcodeGenerator();
            const barcode = barcodeGenerator.generateBarcode('TEST123');
            if (barcode && barcode.includes('<svg')) {
                log('âœ“ Barcode generator working correctly', 'success');
            } else {
                log('âœ— Barcode generator not working', 'error');
            }

            // Test 11: Verify all recipes exist
            const allRecipes = recipeManager.getAllRecipes();
            log(`âœ“ Total recipes in system: ${allRecipes.length}`, 'success');

            log('ðŸŽ‰ All tests completed successfully!', 'success');

        } catch (error) {
            log(`âœ— Test failed: ${error.message}`, 'error');
            console.error('Full error:', error);
        }
    </script>
</body>
</html>