<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UI Controller Test</title>
</head>
<body>
    <h1>UI Controller Test</h1>
    <div id="results"></div>

    <!-- Load modules in correct order -->
    <script src="js/storage-manager.js"></script>
    <script src="js/data-models.js"></script>
    <script src="js/barcode-scanner.js"></script>
    <script src="js/product-database.js"></script>
    <script src="js/recipe-manager.js"></script>
    <script src="js/portion-calculator.js"></script>
    <script src="js/ui-controller.js"></script>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.style.padding = '5px';
            div.style.margin = '2px';
            div.style.borderRadius = '3px';
            
            if (type === 'success') {
                div.style.backgroundColor = '#d4edda';
                div.style.color = '#155724';
            } else if (type === 'error') {
                div.style.backgroundColor = '#f8d7da';
                div.style.color = '#721c24';
            } else {
                div.style.backgroundColor = '#d1ecf1';
                div.style.color = '#0c5460';
            }
            
            div.textContent = message;
            results.appendChild(div);
            console.log(message);
        }

        // Wait for all scripts to load
        setTimeout(() => {
            try {
                log('üöÄ Testing UI Controller initialization without DOM elements');
                
                // Clear any existing data first
                const storage = new StorageManager();
                storage.clearAll();
                log('‚úÖ Storage cleared');
                
                // Create components
                const recipeManager = new RecipeManager(storage);
                const calculator = new PortionCalculator();
                const productDb = new ProductDatabase(storage);
                log('‚úÖ Core components created');
                
                // Test UIController creation (this should not fail even without DOM elements)
                const uiController = new UIController(recipeManager, calculator, productDb, storage);
                log('‚úÖ UIController created successfully without DOM elements');
                
                // Test that methods don't crash when DOM elements are missing
                uiController.showSuccessMessage('Test success message');
                log('‚úÖ showSuccessMessage works (console fallback)');
                
                uiController.showErrorMessage('Test error message');
                log('‚úÖ showErrorMessage works (console fallback)');
                
                uiController.updateRecipeList();
                log('‚úÖ updateRecipeList works (safe element access)');
                
                uiController.updateRecipeSelector();
                log('‚úÖ updateRecipeSelector works (safe element access)');
                
                uiController.updateEmptyStates();
                log('‚úÖ updateEmptyStates works (safe element access)');
                
                uiController.showView('recipe-list-view');
                log('‚úÖ showView works (safe element access)');
                
                uiController.resetRecipeForm();
                log('‚úÖ resetRecipeForm works (safe element access)');
                
                // Test recipe creation to ensure no DOM-related crashes
                const recipe = recipeManager.createRecipe('Test Recipe', [
                    { name: 'Test Ingredient', weight: 100 }
                ]);
                log('‚úÖ Recipe created: ' + recipe.name);
                
                // Test that UI methods still work after recipe creation
                uiController.updateRecipeList();
                uiController.updateRecipeSelector();
                uiController.updateEmptyStates();
                log('‚úÖ UI methods work after recipe creation');
                
                // Cleanup
                storage.clearAll();
                log('üéâ All UI Controller tests passed! DOM-safe operation confirmed.');
                
            } catch (error) {
                log('‚ùå Test failed: ' + error.message, 'error');
                console.error('Test error:', error);
            }
        }, 300);
    </script>
</body>
</html>